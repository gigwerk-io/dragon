<ngx-spinner></ngx-spinner>


<!-- SKELETON CAROUSEL -->
<ng-template #skeletonCarousel>
    <div class="w-full p-0">
        <ion-skeleton-text class="rounded-lg w-full" style="height: 33rem"></ion-skeleton-text>
    </div>
</ng-template>

<!-- SKELETON FORM -->
<ng-template #skeletonForm>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 md:px-8 " style="margin-top: 73px;">
        <div>
            <ion-skeleton-text animated style="width: 100px; height: 22px; margin-bottom: 10px;"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 120px; "></ion-skeleton-text>

        </div>
        <ion-skeleton-text animated style="width: 100%; height: 1px;" class="my-5"></ion-skeleton-text>
        <div>
            <ion-skeleton-text animated style="width: 70px; height: 19px;" class="inline-block"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 443px; height: 37px; margin-left: 341px; border-radius: 7px;"
                class="inline-block"></ion-skeleton-text>
        </div>
        <ion-skeleton-text animated style="width: 100%; height: 1px;" class="my-5"></ion-skeleton-text>
        <div>
            <ion-skeleton-text animated style="width: 70px; height: 19px;" class="inline-block"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 443px; height: 37px; margin-left: 341px; border-radius: 7px;"
                class="inline-block"></ion-skeleton-text>
        </div>
        <ion-skeleton-text animated style="width: 100%; height: 1px;" class="my-5"></ion-skeleton-text>
        <div>
            <ion-skeleton-text animated style="width: 70px; height: 19px;" class="inline-block"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 443px; height: 37px; margin-left: 341px; border-radius: 7px;"
                class="inline-block"></ion-skeleton-text>
        </div>
        <ion-skeleton-text animated style="width: 100%; height: 1px;" class="my-5"></ion-skeleton-text>
        <div>
            <ion-skeleton-text animated style="width: 70px; height: 19px;" class="inline-block"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 443px; height: 37px; margin-left: 341px; border-radius: 7px;"
                class="inline-block"></ion-skeleton-text>
        </div>
        <ion-skeleton-text animated style="width: 100%; height: 1px;" class="my-5"></ion-skeleton-text>
        <div>
            <ion-skeleton-text animated style="width: 70px; height: 19px;" class="inline-block"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 443px; height: 37px; margin-left: 341px; border-radius: 7px;"
                class="inline-block"></ion-skeleton-text>
        </div>
        <ion-skeleton-text animated style="width: 100%; height: 1px;" class="my-5"></ion-skeleton-text>
        <div>
            <ion-skeleton-text animated style="width: 70px; height: 19px;" class="inline-block"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 443px; height: 37px; margin-left: 341px; border-radius: 7px;"
                class="inline-block"></ion-skeleton-text>
        </div>
        <ion-skeleton-text animated style="width: 100%; height: 1px;" class="my-5"></ion-skeleton-text>
        <div>
            <ion-skeleton-text animated style="width: 70px; height: 19px;" class="inline-block"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 443px; height: 37px; margin-left: 341px; border-radius: 7px;"
                class="inline-block"></ion-skeleton-text>
        </div>
        <ion-skeleton-text animated style="width: 100%; height: 1px;" class="my-5"></ion-skeleton-text>
        <div>
            <ion-skeleton-text animated style="width: 70px; height: 19px;" class="inline-block"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 443px; height: 37px; margin-left: 341px; border-radius: 7px;"
                class="inline-block"></ion-skeleton-text>
        </div>
        <ion-skeleton-text animated style="width: 100%; height: 1px;" class="my-5"></ion-skeleton-text>

        <div>
            <ion-skeleton-text animated style="width: 70px; height: 19px;" class="inline-block"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 443px; height: 103px; margin-left: 341px; border-radius: 7px;"
                class="inline-block"></ion-skeleton-text>
        </div>


    </div>
</ng-template>

<!-- CAROUSEL -->
<div class="carousel relative bg-white mb-100" *ngIf="job; else skeletonCarousel">
    <div class="carousel-inner relative rounded-lg overflow-hidden w-full">
        <!--Slide 1-->
        <div>
            <input class="carousel-open" type="radio" id="carousel-1" name="carousel" aria-hidden="true" hidden=""
                checked="checked">
            <div class="carousel-item absolute opacity-0" style="height:33rem;">
                <div class="block h-full w-full  text-white text-5xl text-center bg-cover bg-center"
                    [ngStyle]="{'background-image': 'url('+ images[0] + ')'}"></div>
                <!-- <img [src]="images[0]" class="" alt="" style="object-fit: cover;"> -->
            </div>
            <label for="carousel-3"
                class="prev control-1 w-10 h-10 ml-2 md:ml-10 absolute cursor-pointer hidden text-3xl font-bold text-black hover:text-white rounded-full bg-white hover:bg-blue-700 leading-tight text-center z-10 inset-y-0 left-0 my-auto">‹</label>
            <label for="carousel-2"
                class="next control-1 w-10 h-10 mr-2 md:mr-10 absolute cursor-pointer hidden text-3xl font-bold text-black hover:text-white rounded-full bg-white hover:bg-blue-700 leading-tight text-center z-10 inset-y-0 right-0 my-auto">›</label>
        </div>


        <!--Slide 2-->
        <div *ngIf="images[1] !== undefined">
            <input class="carousel-open" type="radio" id="carousel-2" name="carousel" aria-hidden="true" hidden="">
            <div class="carousel-item absolute opacity-0" style="height:33rem;">
                <div class="block h-full w-full  text-white text-5xl text-center bg-cover bg-center"
                    [ngStyle]="{'background-image': 'url('+ images[1] + ')'}"></div>
            </div>
            <label for="carousel-1"
                class="prev control-2 w-10 h-10 ml-2 md:ml-10 absolute cursor-pointer hidden text-3xl font-bold text-black hover:text-white rounded-full bg-white hover:bg-blue-700 leading-tight text-center z-10 inset-y-0 left-0 my-auto">‹</label>
            <label for="carousel-3"
                class="next control-2 w-10 h-10 mr-2 md:mr-10 absolute cursor-pointer hidden text-3xl font-bold text-black hover:text-white rounded-full bg-white hover:bg-blue-700 leading-tight text-center z-10 inset-y-0 right-0 my-auto">›</label>
        </div>

        <!--Slide 3-->
        <div *ngIf="images[2] !== undefined">
            <input class="carousel-open" type="radio" id="carousel-3" name="carousel" aria-hidden="true" hidden="">
            <div class="carousel-item absolute opacity-0" style="height:33rem;">
                <div class="block h-full w-full  text-white text-5xl text-center bg-cover bg-center"
                    [ngStyle]="{'background-image': 'url('+ images[2] + ')'}"></div>
                <!-- <img [src]="images[0]" class="" alt="" style="object-fit: cover;"> -->
            </div>
            <label for="carousel-2"
                class="prev control-3 w-10 h-10 ml-2 md:ml-10 absolute cursor-pointer hidden text-3xl font-bold text-black hover:text-white rounded-full bg-white hover:bg-blue-700 leading-tight text-center z-10 inset-y-0 left-0 my-auto">‹</label>
            <label for="carousel-1"
                class="next control-3 w-10 h-10 mr-2 md:mr-10 absolute cursor-pointer hidden text-3xl font-bold text-black hover:text-white rounded-full bg-white hover:bg-blue-700 leading-tight text-center z-10 inset-y-0 right-0 my-auto">›</label>

        </div>
        <!-- Add additional indicators for each slide-->
        <ol class="carousel-indicators">
            <li class="inline-block mr-3" *ngFor='let image of images; let i = index'>
                <label for="carousel-{{i}}"
                    class="carousel-bullet cursor-pointer block text-4xl text-white hover:text-blue-700">•</label>
            </li>
        </ol>
    </div>
</div>

<!-- FORM -->

<div class="container mx-auto   mt-200" *ngIf="job; else skeletonForm">
    <form class="w-full mx-auto pl-0 sm:pl-5" [formGroup]="jobDetailsForm" (ngSubmit)="onSubmit()">
        <div>
            <div class="mt-8 border-t border-gray-200 pt-8 sm:mt-5 sm:pt-10">
                <div class=" inline-block">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">
                        Job Details
                    </h3>
                    <p class="mt-1 max-w-2xl text-sm leading-5 text-gray-500">
                        Update Job Details
                    </p>
                </div>
                <div class=" inline-block" style="margin-left: 70%;">
                    <button type="button" (click)="showModal = true"
                        class="inline-flex bg-blue-100 items-center px-6 py-3 border border-transparent text-base leading-6 font-medium rounded-md text-blue-700  hover:bg-blue-50 focus:outline-none focus:border-indigo-300 focus:shadow-outline-blue active:bg-blue-200 transition ease-in-out duration-150">
                        <span *ngIf="!job.proposals.length">Assign this Job to a Freelancer</span>
                        <span *ngIf="!assignedFreelancer && job.status == 'Pending Approval'">Job is pending
                            approval</span>
                        <span *ngIf="assignedFreelancer">Job is assigned to
                            {{assignedFreelancer.user.first_name}} {{assignedFreelancer.user.last_name}}</span>
                    </button>
                </div>
                <div class="mt-6 sm:mt-5">

                    <div
                        class="mt-6 sm:mt-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5">
                        <label for="intensity"
                            class="block text-sm font-medium leading-5 text-gray-700 sm:mt-px sm:pt-2">
                            Intensity
                        </label>
                        <div class="mt-1 sm:mt-0 ">
                            <div class="max-w-lg rounded-md shadow-sm sm:max-w-xs">

                                <select id="intensity" formControlName="intensity"
                                    [ngClass]="{'invalid': !jobDetailsForm.controls.intensity.valid}"
                                    class="block form-select w-full transition duration-150 ease-in-out sm:text-sm sm:leading-5">
                                    <option value="Easy">Easy
                                    </option>
                                    <option value="Medium">Medium
                                    </option>
                                    <option value="Hard">Hard
                                    </option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div
                        class="mt-6 sm:mt-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5">
                        <label for="email" class="block text-sm font-medium leading-5 text-gray-700 sm:mt-px sm:pt-2">
                            Email address
                        </label>
                        <div class="mt-1 flex rounded-md shadow-sm "
                            [ngClass]="{'invalid': !jobDetailsForm.controls.email.valid}">
                            <span
                                class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                                <i class="fas fa-envelope"></i>
                            </span>
                            <input id="company_website" formControlName="email" disabled
                                class="form-input flex-1 block w-full px-3 py-2 rounded-none rounded-r-md sm:text-sm sm:leading-5"
                                placeholder="johnsmith@example.com" />
                        </div>
                    </div>

                    <div
                        class="mt-6 sm:mt-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5">
                        <label for="completeBefore"
                            class="block text-sm font-medium leading-5 text-gray-700 sm:mt-px sm:pt-2">
                            Complete Before
                        </label>
                        <div class="mt-1 flex rounded-md shadow-sm ">
                            <input id="completeBefore" formControlName="complete_before"
                                [ngClass]="{'invalid': !jobDetailsForm.controls.complete_before.valid}"
                                class="form-input flex-1 block w-full px-3 py-2 rounded-none rounded-r-md sm:text-sm sm:leading-5"
                                type="datetime-local" />
                        </div>
                    </div>

                    <div
                        class="mt-6 sm:mt-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5">
                        <label for="price" class="block text-sm font-medium leading-5 text-gray-700 sm:mt-px sm:pt-2">
                            Price
                        </label>
                        <div class="mt-1 relative rounded-md shadow-sm"
                            [ngClass]="{'invalid': !jobDetailsForm.controls.price.valid}">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500 sm:text-sm sm:leading-5">
                                    <i class="fas fa-dollar-sign"></i>
                                </span>
                            </div>
                            <input id="price" class="form-input block w-full pl-7 pr-12 sm:text-sm sm:leading-5"
                                formControlName="price" aria-describedby="price-currency" />
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                <span class="text-gray-500 sm:text-sm sm:leading-5" id="price-currency">
                                    USD
                                </span>
                            </div>
                        </div>
                    </div>


                    <div formGroupName="location"
                        class="mt-6 sm:mt-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5">
                        <label for="address" class="block text-sm font-medium leading-5 text-gray-700 sm:mt-px sm:pt-2">
                            Street Address
                        </label>
                        <div class="mt-1 flex rounded-md shadow-sm "
                            [ngClass]="{'invalid': !jobDetailsForm.controls.location.controls.street_address.valid}">
                            <span
                                class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                                <i class="fas fa-street-view"></i>
                            </span>
                            <input id="address" type="text" formControlName="street_address"
                                class="form-input flex-1 block w-full px-3 py-2 rounded-none rounded-r-md sm:text-sm sm:leading-5"
                                placeholder="1234 Main St" />
                        </div>
                    </div>

                    <div formGroupName="location"
                        class="mt-6 sm:mt-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5">
                        <label for="city" class="block text-sm font-medium leading-5 text-gray-700 sm:mt-px sm:pt-2">
                            City
                        </label>
                        <div class="mt-1 flex rounded-md shadow-sm "
                            [ngClass]="{'invalid': !jobDetailsForm.controls.location.controls.city.valid}">
                            <span
                                class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                                <i class="fas fa-city"></i>
                            </span>
                            <input id="city" type="text" formControlName="city"
                                class="form-input flex-1 block w-full px-3 py-2 rounded-none rounded-r-md sm:text-sm sm:leading-5"
                                placeholder="Minneapolis" />
                        </div>
                    </div>

                    <div formGroupName="location"
                        class="mt-6 sm:mt-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5">
                        <label for="state" class="block text-sm font-medium leading-5 text-gray-700 sm:mt-px sm:pt-2">
                            State
                        </label>
                        <div class="mt-1 flex rounded-md shadow-sm "
                            [ngClass]="{'invalid': !jobDetailsForm.controls.location.controls.state.valid}">
                            <span
                                class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                                <i class="fas fa-map-marker-alt"></i>
                            </span>
                            <input id="state" type="text" formControlName="state"
                                class="form-input flex-1 block w-full px-3 py-2 rounded-none rounded-r-md sm:text-sm sm:leading-5"
                                placeholder="MN" minlength="2" maxlength="2" />

                        </div>

                    </div>

                    <div formGroupName="location"
                        class="mt-6 sm:mt-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5">
                        <label for="zipcode" class="block text-sm font-medium leading-5 text-gray-700 sm:mt-px sm:pt-2">
                            Zipcode
                        </label>
                        <div class="mt-1 flex rounded-md shadow-sm  "
                            [ngClass]="{'invalid': !jobDetailsForm.controls.location.controls.zip.valid}">
                            <span
                                class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                                <i class="fas fa-search-location"></i>
                            </span>
                            <input id="zipcode" type="text" formControlName="zip"
                                class=" focus:outline-0 form-input flex-1 block w-full px-3 py-2 rounded-none rounded-r-md sm:text-sm sm:leading-5"
                                placeholder="22445" minlength="5" maxlength="5" />
                        </div>
                    </div>

                    <div
                        class="mt-6 sm:mt-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:items-start sm:border-t sm:border-gray-200 sm:pt-5">
                        <label for="description"
                            class="block text-sm font-medium leading-5 text-gray-700 sm:mt-px sm:pt-2">
                            Description
                        </label>
                        <div class="mt-1 sm:mt-0 sm:col-span-2">
                            <div class="max-w-lg flex rounded-md shadow-sm">
                                <textarea id="description" rows="3" formControlName="description"
                                    [ngClass]="{'invalid': !jobDetailsForm.controls.description.valid}"
                                    class="form-textarea block w-full transition duration-150 ease-in-out sm:text-sm sm:leading-5"></textarea>
                            </div>
                            <p class="mt-2 text-sm text-gray-500">Please provide information and requirements for the
                                job.
                            </p>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="mt-8 border-t border-gray-200 pt-5">
            <div class="flex justify-end">
                <span class="ml-3 inline-flex rounded-md shadow-sm">
                    <button type="submit"
                        class="inline-flex justify-center py-2 px-4 border border-transparent text-sm leading-5 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition duration-150 ease-in-out">
                        Update
                    </button>
                </span>
            </div>
        </div>
    </form>
</div>

<!-- MODAL -->

<div class="fixed bottom-0 inset-x-0 px-4 pb-6 sm:inset-0 sm:p-0 sm:flex sm:items-center sm:justify-center"
    *ngIf="showModal">

    <div class="fixed inset-0 transition-opacity" (click)="showModal = false">
        <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
    </div>



    <div class="bg-white rounded-lg px-4 pt-5 pb-4 overflow-hidden shadow-xl transform transition-all sm:max-w-lg sm:w-full sm:p-6"
        role="dialog" aria-modal="true" aria-labelledby="modal-headline">
        <div class="w-full">
            <div class="inline-block">
                <p>Verified Freelancers</p>
            </div>
            <div class="inline-block" style="margin-left: 66%;">
                <p (click)="showModal = false" class="cursor-pointer"> &#10005;</p>
            </div>
        </div>

        <!-- SEARCH BAR -->
        <div class="mt-5">
            <div class="mt-1 flex rounded-md shadow-sm">
                <span
                    class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 sm:text-sm">
                    <i class="fas fa-search"></i>
                </span>
                <input id="company_website" (input)="searchUser($event.target.value)"
                    class="form-input flex-1 block w-full px-3 py-2 rounded-none rounded-r-md sm:text-sm sm:leading-5"
                    placeholder="Search Freelancers" />
            </div>
        </div>


        <!-- Modal Body -->
        <div class="mt-5 overflow-y-scroll" style="height: 500px;">
            <div class="flex  rounded-lg pl-2 bg-gray-100 hover:bg-gray-200 my-4 "
                *ngFor="let user of freelancers; let i = index">

                <div class="flex-initial text-center pt-3">
                    <img src="{{user.profile.image}}" class="" style="border-radius: 100%; width: 90px;" alt="">
                </div>
                <div class="flex-initial px-2 py-2 overflow-y-hidden  pt-3  w-full">
                    <p>{{user.first_name}} {{user.last_name}}</p>
                    <p class="text-sm">{{user.profile.description}}</p>
                </div>
                <div class="flex-initial text-center px-4 pt-5 m-2">
                    <span class="inline-flex rounded-md shadow-sm">

                        <button type="button"
                            *ngIf="assignedFreelancer && assignedFreelancer.id === user.id; else unassigned "
                            class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 bg-green-600 font-medium rounded-md text-white  hover:bg-green-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition ease-in-out duration-150">
                            <i *ngIf="!user.proposed" class="fas fa-user-check mr-1"></i>
                            <i *ngIf="user.proposed" class="fas fa-chalkboard-teacher"></i>
                            <span class="ml-1">Assigned</span>
                        </button>

                        <ng-template #unassigned>
                            <button type="button" [disabled]="user.proposed" (click)="proposeUser(user, i)"
                                class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white  hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition ease-in-out duration-150"
                                [ngClass]="{'bg-gray-600': user.proposed, 'bg-indigo-600': !user.proposed}">
                                <i *ngIf="!user.proposed" class="fas fa-chalkboard-teacher mr-1"></i>
                                <i *ngIf="user.proposed" class="fas fa-user-lock mr-1"></i>
                                <span *ngIf="user.proposed" class="ml-1">Proposed</span>
                                <span *ngIf="!user.proposed" class="ml-1">Propose</span>
                            </button>
                        </ng-template>
                    </span>
                </div>
            </div>
            <div class="flex  rounded-lg pl-2 bg-gray-100 hover:bg-gray-200 my-4 " *ngIf="!freelancers.length">

                No freelancers found...
            </div>


        </div>

    </div>
</div>